{"data":{"edges":[],"nodes":[{"data":{"id":"ChromaManageCollections-BO3mJ","node":{"template":{"_type":"CustomComponent","code":{"type":"code","required":true,"placeholder":"","list":false,"show":true,"multiline":true,"value":"from langflow import CustomComponent\r\nfrom langflow.schema import Message\r\nfrom langflow.inputs import DropdownInput, StrInput\r\nfrom chromadb import Client\r\nfrom chromadb.config import Settings\r\nfrom typing import Optional\r\n\r\n# Componente criado por Pedro Collares Xavier\r\n\r\nclass ChromaManageCollections(CustomComponent):\r\n    display_name = \"Gerenciador de Coleções ChromaDB\"\r\n    description = \"Gerencia coleções no ChromaDB (listar/deletar)\"\r\n    icon = \"ChromaDB\"\r\n    \r\n    def build_config(self):\r\n        return {\r\n            \"operation\": DropdownInput(\r\n                options=[\"list\", \"delete\"],\r\n                value=\"list\",\r\n                display_name=\"Operação\",\r\n                name=\"operation\"\r\n            ).to_dict(),\r\n            \"collection_name\": StrInput(\r\n                display_name=\"Nome da Coleção\",\r\n                info=\"Obrigatório para deletar\",\r\n                required=False,\r\n                name=\"collection_name\"\r\n            ).to_dict(),\r\n            \"persist_directory\": StrInput(\r\n                display_name=\"Diretório de Dados\",\r\n                value=\"/app/chromadb\",\r\n                name=\"persist_directory\"\r\n            ).to_dict(),\r\n        }\r\n\r\n    def build(self, operation: str, persist_directory: str, collection_name: Optional[str] = None, **kwargs) -> Message:\r\n        try:\r\n            # Garante que operation seja uma string mesmo se vier como lista\r\n            if isinstance(operation, list):\r\n                operation = operation[0]\r\n            operation = operation.lower().strip()\r\n\r\n            client = Client(Settings(\r\n                persist_directory=persist_directory,\r\n                is_persistent=True\r\n            ))\r\n\r\n            if operation == \"list\":\r\n                collections = client.list_collections()\r\n                if not collections:\r\n                    return Message(text=\"Nenhuma coleção encontrada no ChromaDB.\")\r\n                \r\n                collection_list = \"\\n\".join([f\"- {col.name}\" for col in collections])\r\n                return Message(\r\n                    text=f\"Coleções disponíveis:\\n{collection_list}\",\r\n                    data={\"collections\": [col.name for col in collections]}\r\n                )\r\n\r\n            elif operation == \"delete\":\r\n                if not collection_name:\r\n                    return Message(text=\"Erro: Você deve especificar o nome da coleção para deletar\")\r\n                \r\n                # Verifica se a coleção existe\r\n                existing = [col.name for col in client.list_collections()]\r\n                if collection_name not in existing:\r\n                    return Message(text=f\"Erro: Coleção '{collection_name}' não existe\")\r\n                \r\n                # Executa o delete\r\n                client.delete_collection(name=collection_name)\r\n                \r\n                # Verifica se foi removida\r\n                updated = [col.name for col in client.list_collections()]\r\n                if collection_name in updated:\r\n                    return Message(text=f\"Falha: Coleção '{collection_name}' não foi removida\")\r\n                \r\n                return Message(\r\n                    text=f\"✅ Coleção '{collection_name}' removida com sucesso\",\r\n                    data={\"deleted\": collection_name, \"remaining\": updated}\r\n                )\r\n\r\n            return Message(text=f\"Operação desconhecida: '{operation}'. Use 'list' ou 'delete'\")\r\n\r\n        except Exception as e:\r\n            return Message(text=f\"⚠️ Erro ao processar: {str(e)}\")\r\n","fileTypes":[],"file_path":"","password":false,"name":"code","advanced":true,"dynamic":true,"info":"","load_from_db":false,"title_case":false},"collection_name":{"type":"str","required":false,"placeholder":"","list":false,"show":true,"multiline":false,"value":"Teste-delete","fileTypes":[],"file_path":"","name":"collection_name","display_name":"Nome da Coleção","advanced":false,"dynamic":false,"info":"Obrigatório para deletar","load_from_db":false,"title_case":false,"input_types":["Text"]},"operation":{"type":"str","required":false,"placeholder":"","list":true,"show":true,"multiline":false,"value":["list"],"fileTypes":[],"file_path":"","options":["list","delete"],"name":"operation","display_name":"Operação","advanced":false,"dynamic":false,"info":"","load_from_db":false,"title_case":false,"input_types":["Text"]},"persist_directory":{"type":"str","required":false,"placeholder":"","list":false,"show":true,"multiline":false,"value":"/app/chroma","fileTypes":[],"file_path":"","name":"persist_directory","display_name":"Diretório de Dados","advanced":false,"dynamic":false,"info":"","load_from_db":false,"title_case":false,"input_types":["Text"]}},"description":"Gerencia coleções no ChromaDB (listar/deletar)","icon":"ChromaDB","base_classes":["Data","Message"],"display_name":"Gerenciador de Coleções ChromaDB","documentation":"","minimized":false,"custom_fields":{"operation":null,"persist_directory":null,"collection_name":null},"output_types":["Message"],"pinned":false,"conditional_paths":[],"frozen":false,"outputs":[{"types":["Message"],"selected":"Message","name":"message","hidden":null,"display_name":"Message","method":null,"value":"__UNDEFINED__","cache":true,"required_inputs":null,"allows_loop":false,"options":null,"tool_mode":true}],"field_order":[],"beta":false,"legacy":false,"edited":true,"metadata":{},"tool_mode":false,"official":false},"showNode":true,"type":"ChromaManageCollections"},"id":"ChromaManageCollections-BO3mJ","position":{"x":0,"y":0},"type":"genericNode"}],"viewport":{"x":1,"y":1,"zoom":1}},"description":"Gerencia coleções no ChromaDB (listar/deletar)","name":"Gerenciador de Coleções ChromaDB","id":"ChromaManageCollections-BO3mJ","is_component":true,"last_tested_version":"1.4.3"}